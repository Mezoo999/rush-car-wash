(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,86536,e=>{"use strict";let t=(0,e.i(75254).default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>t],86536)},55436,e=>{"use strict";let t=(0,e.i(75254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["Search",()=>t],55436)},23750,e=>{"use strict";var t=e.i(43476),r=e.i(47163);function a({className:e,type:a,...s}){return(0,t.jsx)("input",{type:a,"data-slot":"input",className:(0,r.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",e),...s})}e.s(["Input",()=>a])},84614,e=>{"use strict";let t=(0,e.i(75254).default)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);e.s(["User",()=>t],84614)},72520,e=>{"use strict";let t=(0,e.i(75254).default)("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);e.s(["ArrowRight",()=>t],72520)},38691,e=>{"use strict";var t=e.i(71645),r=e.i(20755),a=e.i(46696);function s(e={}){let{userId:i,userRole:n="customer",enabled:l=!0}=e,[c,o]=(0,t.useState)([]),[d,u]=(0,t.useState)(!0),[m,h]=(0,t.useState)(null),g=(0,t.useRef)(null),p=(0,t.useRef)(!0),x=(0,t.useCallback)(async()=>{if(l)try{u(!0),h(null);let e=r.supabase.from("orders").select(`
          *,
          car:cars(*),
          service:services(*),
          worker:users!orders_worker_id_fkey(*)
        `).order("created_at",{ascending:!1});"customer"===n&&i?e=e.eq("user_id",i):"worker"===n&&i&&(e=e.eq("worker_id",i));let{data:t,error:a}=await e;if(a)throw a;p.current&&o(t||[])}catch(e){console.error("Error fetching orders:",e),p.current&&h(e instanceof Error?e:Error("Failed to fetch orders"))}finally{p.current&&u(!1)}},[i,n,l]);return(0,t.useEffect)(()=>{if(p.current=!0,x(),l)return g.current=r.supabase.channel(`orders_${n}_${i||"admin"}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"orders"},async e=>{let t=e.new;if(("admin"===n||"customer"===n&&t.user_id===i||"worker"===n&&t.worker_id===i)&&p.current){let{data:e}=await r.supabase.from("orders").select(`
                *,
                car:cars(*),
                service:services(*),
                worker:users!orders_worker_id_fkey(*)
              `).eq("id",t.id).single();e&&(o(t=>[e,...t]),"admin"===n&&a.toast.success("طلب جديد!",{description:`طلب جديد بقيمة ${t.total_amount} ج.م`}))}}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"orders"},e=>{var t,r,s;let i=e.new,l=e.old;p.current&&(o(e=>e.map(e=>e.id===i.id?{...e,...i}:e)),l.status!==i.status&&(t=i,r=l.status,"customer"===(s=n)?a.toast.info("تحديث الحالة",{description:`حالة طلبك تغيرت إلى: ${{pending:"معلق",confirmed:"مؤكد",assigned:"تم التعيين",on_the_way:"في الطريق",in_progress:"قيد التنفيذ",completed:"مكتمل",cancelled:"ملغي"}[t.status]}`}):"worker"===s&&a.toast.info("تحديث",{description:`تم تحديث حالة الطلب ${t.id.slice(0,8)}`})))}).subscribe(),()=>{p.current=!1,g.current&&r.supabase.removeChannel(g.current)}},[i,n,l,x]),{orders:c,loading:d,error:m,refresh:(0,t.useCallback)(()=>x(),[x]),setOrders:o}}function i(e){let[a,s]=(0,t.useState)({today:0,week:0,month:0,totalJobs:0,completedJobs:0}),[i,n]=(0,t.useState)(!1);return(0,t.useEffect)(()=>{e&&(async()=>{n(!0);try{let t=new Date().toISOString().split("T")[0],a=new Date(Date.now()-6048e5).toISOString().split("T")[0],i=new Date(Date.now()-2592e6).toISOString().split("T")[0],{data:n}=await r.supabase.from("orders").select("total_amount, status, created_at").eq("worker_id",e).eq("status","completed");if(n){let e=n.filter(e=>e.created_at.startsWith(t)).reduce((e,t)=>e+t.total_amount,0),r=n.filter(e=>e.created_at>=a).reduce((e,t)=>e+t.total_amount,0),l=n.filter(e=>e.created_at>=i).reduce((e,t)=>e+t.total_amount,0);s({today:e,week:r,month:l,totalJobs:n.length,completedJobs:n.length})}}catch(e){console.error("Error fetching earnings:",e)}finally{n(!1)}})()},[e]),{earnings:a,loading:i}}e.s(["useRealtimeOrders",()=>s,"useWorkerEarnings",()=>i])},46897,e=>{"use strict";let t=(0,e.i(75254).default)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);e.s(["MapPin",()=>t],46897)},87316,e=>{"use strict";let t=(0,e.i(75254).default)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);e.s(["Calendar",()=>t],87316)},5125,e=>{"use strict";let t=(0,e.i(75254).default)("car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);e.s(["Car",()=>t],5125)},94179,e=>{"use strict";var t=e.i(43476),r=e.i(25913),a=e.i(86011),s=e.i(47163);let i=(0,r.cva)("inline-flex items-center justify-center rounded-full border border-transparent px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border-border text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground",ghost:"[a&]:hover:bg-accent [a&]:hover:text-accent-foreground",link:"text-primary underline-offset-4 [a&]:hover:underline"}},defaultVariants:{variant:"default"}});function n({className:e,variant:r="default",asChild:n=!1,...l}){let c=n?a.Slot.Root:"span";return(0,t.jsx)(c,{"data-slot":"badge","data-variant":r,className:(0,s.cn)(i({variant:r}),e),...l})}e.s(["Badge",()=>n])},50337,73297,e=>{"use strict";function t(e,t){switch(t){case"suv":return e.base_price_suv;case"luxury":return e.base_price_luxury;default:return e.base_price_standard}}function r(e){return e.reduce((e,t)=>e+t.price,0)}function a(e){return`${new Intl.NumberFormat("ar-EG",{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)} ج.م`}function s(e){return new Date(e).toLocaleDateString("ar-EG",{year:"numeric",month:"long",day:"numeric"})}function i(e){let[t,r]=e.split(":"),a=parseInt(t,10);return`${a>12?a-12:0===a?12:a}:${r} ${a>=12?"م":"ص"}`}function n(e=1990,t=new Date().getFullYear()){let r=[];for(let a=t;a>=e;a--)r.push(a);return r}function l(){let e=new Date;return e.setDate(e.getDate()+1),e.toISOString().split("T")[0]}function c(e=30){let t=new Date;return t.setDate(t.getDate()+e),t.toISOString().split("T")[0]}e.s(["CAR_BRANDS",0,["Toyota","Honda","Nissan","Hyundai","Kia","BMW","Mercedes","Audi","Volkswagen","Ford","Chevrolet","Peugeot","Renault","Fiat","Chery","BYD","MG","Geely","Changan","Suzuki","Mitsubishi","Subaru","Lexus","Infiniti","Acura","Volvo","Jaguar","Land Rover","Porsche","Tesla"],"CATEGORY_LABELS",0,{standard:"عادية",suv:"دفع رباعي",luxury:"فاخرة"},"PAYMENT_METHOD_LABELS",0,{cash:"كاش",online:"دفع إلكتروني"},"SERVICE_AREAS",0,["6th of October","Sheikh Zayed"],"STATUS_COLORS",0,{pending:"bg-yellow-500",confirmed:"bg-blue-500",assigned:"bg-purple-500",on_the_way:"bg-orange-500",in_progress:"bg-cyan-500",completed:"bg-green-500",cancelled:"bg-red-500"},"STATUS_LABELS",0,{pending:"معلق",confirmed:"مؤكد",assigned:"تم التعيين",on_the_way:"في الطريق",in_progress:"قيد التنفيذ",completed:"مكتمل",cancelled:"ملغي"},"TIME_SLOTS",0,["09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30"]],73297),e.s(["calculateAddOnsTotal",()=>r,"calculateServicePrice",()=>t,"formatDate",()=>s,"formatPriceWithCurrency",()=>a,"formatTime",()=>i,"getMaxBookingDate",()=>c,"getTomorrowDate",()=>l,"getYearsRange",()=>n],50337)},76664,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(46932),s=e.i(70065),i=e.i(67881),n=e.i(94179),l=e.i(23750),c=e.i(55436),o=e.i(75254);let d=(0,o.default)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);var u=e.i(86536),m=e.i(46897),h=e.i(87316),g=e.i(84614),p=e.i(5125),x=e.i(72520);let f=(0,o.default)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]);var v=e.i(37727),y=e.i(38691),b=e.i(73297),w=e.i(50337),j=e.i(20755),_=e.i(46696),N=e.i(22016);let k={pending:"bg-yellow-500",confirmed:"bg-blue-500",assigned:"bg-purple-500",on_the_way:"bg-orange-500",in_progress:"bg-cyan-500",completed:"bg-green-500",cancelled:"bg-red-500"};function S(){let{orders:e,loading:o}=(0,y.useRealtimeOrders)({userRole:"admin"}),[S,C]=(0,r.useState)([]),[T,A]=(0,r.useState)(""),[E,D]=(0,r.useState)("all"),[L,M]=(0,r.useState)(""),[B,O]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{let{data:e}=await j.supabase.from("workers").select("*, user:users(*)").eq("is_active",!0);e&&C(e)})()},[]);let R=e.filter(e=>{let t=e.car?.plate_number?.toLowerCase().includes(T.toLowerCase())||e.address?.toLowerCase().includes(T.toLowerCase())||e.id?.slice(0,8).includes(T),r="all"===E||e.status===E,a=!L||e.preferred_date===L;return t&&r&&a}),I=async(e,t)=>{try{let{error:r}=await j.supabase.from("orders").update({worker_id:t,status:"assigned"}).eq("id",e);r||_.toast.success("تم تعيين العامل بنجاح")}catch(e){_.toast.error("فشل في تعيين العامل")}},P=async(e,t)=>{try{let{error:r}=await j.supabase.from("orders").update({status:t}).eq("id",e);r||_.toast.success(`تم تحديث الحالة إلى: ${b.STATUS_LABELS[t]}`)}catch(e){_.toast.error("فشل في تحديث الحالة")}};return o?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-[#d4a574] border-t-transparent rounded-full"})}):(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,t.jsx)("header",{className:"bg-[#1a1a1a] text-white px-6 py-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(N.default,{href:"/admin/dashboard",children:(0,t.jsx)(i.Button,{variant:"ghost",size:"icon",className:"text-white",children:(0,t.jsx)(x.ArrowRight,{className:"w-5 h-5"})})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-xl font-bold",children:"إدارة الطلبات"}),(0,t.jsx)("p",{className:"text-sm text-gray-400",children:"عرض وإدارة جميع الطلبات"})]})]}),(0,t.jsxs)(i.Button,{onClick:()=>{let e=new Blob(["\uFEFF"+["Order ID,Date,Customer,Phone,Car,Service,Address,Preferred Date,Time,Status,Total,Payment",...R.map(e=>[e.id,e.created_at,"عميل","-",`${e.car?.brand} ${e.car?.model} (${e.car?.plate_number})`,e.service?.name_ar||"خدمة غسيل",e.address,e.preferred_date,e.preferred_time,b.STATUS_LABELS[e.status],e.total_amount,b.PAYMENT_METHOD_LABELS[e.payment_method]]).map(e=>e.map(e=>`"${e}"`).join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download=`orders_${new Date().toISOString().split("T")[0]}.csv`,t.click(),_.toast.success("تم تصدير الطلبات بنجاح")},variant:"outline",className:"text-white border-white hover:bg-white/10",children:[(0,t.jsx)(d,{className:"w-4 h-4 ml-2"}),"تصدير CSV"]})]})}),(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsx)(s.Card,{children:(0,t.jsx)(s.CardContent,{className:"p-4",children:(0,t.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4",children:[(0,t.jsxs)("div",{className:"relative flex-1",children:[(0,t.jsx)(c.Search,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,t.jsx)(l.Input,{placeholder:"بحث برقم اللوحة أو العنوان أو رقم الهاتف...",value:T,onChange:e=>A(e.target.value),className:"pr-10"})]}),(0,t.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,t.jsxs)("select",{value:E,onChange:e=>D(e.target.value),className:"border rounded-lg px-3 py-2 text-sm",children:[(0,t.jsx)("option",{value:"all",children:"جميع الحالات"}),Object.entries(b.STATUS_LABELS).map(([e,r])=>(0,t.jsx)("option",{value:e,children:r},e))]}),(0,t.jsx)(l.Input,{type:"date",value:L,onChange:e=>M(e.target.value),className:"w-auto"}),(T||"all"!==E||L)&&(0,t.jsx)(i.Button,{variant:"ghost",size:"icon",onClick:()=>{A(""),D("all"),M("")},children:(0,t.jsx)(v.X,{className:"w-4 h-4"})})]})]})})}),(0,t.jsx)("div",{className:"grid gap-4",children:0===R.length?(0,t.jsx)(s.Card,{children:(0,t.jsxs)(s.CardContent,{className:"p-12 text-center",children:[(0,t.jsx)(f,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-600",children:"لا توجد طلبات"}),(0,t.jsx)("p",{className:"text-gray-400",children:"جرب تغيير معايير البحث"})]})}):R.map(e=>(0,t.jsx)(a.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},layout:!0,children:(0,t.jsx)(s.Card,{className:"hover:shadow-lg transition-shadow",children:(0,t.jsx)(s.CardContent,{className:"p-6",children:(0,t.jsxs)("div",{className:"grid lg:grid-cols-12 gap-4 items-start",children:[(0,t.jsxs)("div",{className:"lg:col-span-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsxs)("span",{className:"font-mono text-sm text-gray-500",children:["#",e.id.slice(-6).toUpperCase()]}),(0,t.jsx)(n.Badge,{className:`${k[e.status]} text-white text-xs`,children:b.STATUS_LABELS[e.status]})]}),(0,t.jsx)("h3",{className:"font-semibold text-lg",children:e.service?.name_ar||"خدمة غسيل"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-[#1a1a1a]",children:(0,w.formatPriceWithCurrency)(e.total_amount)}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:b.PAYMENT_METHOD_LABELS[e.payment_method]})]}),(0,t.jsxs)("div",{className:"lg:col-span-3 space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(g.User,{className:"w-4 h-4 text-gray-400"}),(0,t.jsx)("span",{children:"عميل"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(p.Car,{className:"w-4 h-4 text-gray-400"}),(0,t.jsxs)("span",{children:[e.car?.brand," ",e.car?.model]})]}),(0,t.jsx)("p",{className:"text-sm text-gray-500",dir:"ltr",children:e.car?.plate_number})]}),(0,t.jsxs)("div",{className:"lg:col-span-3 space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)(m.MapPin,{className:"w-4 h-4 text-gray-400 mt-1"}),(0,t.jsx)("span",{className:"text-sm",children:e.address})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(h.Calendar,{className:"w-4 h-4 text-gray-400"}),(0,t.jsxs)("span",{children:[(0,w.formatDate)(e.preferred_date)," - ",e.preferred_time]})]}),e.google_maps_link&&(0,t.jsx)("a",{href:e.google_maps_link,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-500 hover:underline",children:"عرض على الخريطة"})]}),(0,t.jsxs)("div",{className:"lg:col-span-3 flex flex-col gap-2",children:[e.worker?(0,t.jsxs)("div",{className:"text-sm bg-gray-100 rounded-lg px-3 py-2",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"العامل: "}),(0,t.jsx)("span",{className:"font-medium",children:e.worker.full_name})]}):(0,t.jsxs)("select",{className:"border rounded-lg px-3 py-2 text-sm w-full",onChange:t=>t.target.value&&I(e.id,t.target.value),value:"",children:[(0,t.jsx)("option",{value:"",children:"تعيين عامل..."}),S.map(e=>(0,t.jsx)("option",{value:e.user_id,children:e.user?.full_name||e.employee_id},e.id))]}),(0,t.jsxs)("div",{className:"flex gap-2",children:["pending"===e.status&&(0,t.jsx)(i.Button,{size:"sm",className:"flex-1 bg-green-600 hover:bg-green-700",onClick:()=>P(e.id,"confirmed"),children:"تأكيد"}),"confirmed"===e.status&&(0,t.jsx)(i.Button,{size:"sm",className:"flex-1 bg-blue-600 hover:bg-blue-700",onClick:()=>P(e.id,"assigned"),children:"تعيين"}),(0,t.jsxs)(i.Button,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>O(e),children:[(0,t.jsx)(u.Eye,{className:"w-4 h-4 ml-1"}),"التفاصيل"]})]})]})]})})})},e.id))})]})]})}e.s(["default",()=>S],76664)}]);
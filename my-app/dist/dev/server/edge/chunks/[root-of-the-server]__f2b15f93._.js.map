{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { createServerClient, type CookieOptions } from '@supabase/ssr';\nimport { NextResponse, type NextRequest } from 'next/server';\n\nexport async function middleware(request: NextRequest) {\n  let response = NextResponse.next({\n    request: {\n      headers: request.headers,\n    },\n  });\n\n  const supabase = createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        get(name: string) {\n          return request.cookies.get(name)?.value;\n        },\n        set(name: string, value: string, options: CookieOptions) {\n          request.cookies.set({\n            name,\n            value,\n            ...options,\n          });\n          response = NextResponse.next({\n            request: {\n              headers: request.headers,\n            },\n          });\n          response.cookies.set({\n            name,\n            value,\n            ...options,\n          });\n        },\n        remove(name: string, options: CookieOptions) {\n          request.cookies.set({\n            name,\n            value: '',\n            ...options,\n          });\n          response = NextResponse.next({\n            request: {\n              headers: request.headers,\n            },\n          });\n          response.cookies.set({\n            name,\n            value: '',\n            ...options,\n          });\n        },\n      },\n    }\n  );\n\n  // Refresh session if expired\n  const { data: { session } } = await supabase.auth.getSession();\n\n  // Protect routes\n  const pathname = request.nextUrl.pathname;\n  \n  // Protected customer routes\n  const protectedRoutes = ['/booking', '/dashboard', '/profile'];\n  const isProtectedRoute = protectedRoutes.some(route => pathname.startsWith(route));\n  \n  if (isProtectedRoute && !session) {\n    const redirectUrl = new URL('/auth/login', request.url);\n    redirectUrl.searchParams.set('redirect', pathname);\n    return NextResponse.redirect(redirectUrl);\n  }\n\n  // Admin routes protection\n  if (pathname.startsWith('/admin')) {\n    if (!session) {\n      return NextResponse.redirect(new URL('/admin/login', request.url));\n    }\n    \n    // Verify admin role\n    const { data: userData } = await supabase\n      .from('users')\n      .select('role')\n      .eq('id', session.user.id)\n      .single();\n    \n    if (userData?.role !== 'admin') {\n      return NextResponse.redirect(new URL('/', request.url));\n    }\n  }\n\n  // Worker routes protection\n  if (pathname.startsWith('/worker') && !pathname.includes('/login')) {\n    if (!session) {\n      return NextResponse.redirect(new URL('/worker/login', request.url));\n    }\n    \n    // Verify worker role\n    const { data: workerData } = await supabase\n      .from('workers')\n      .select('id')\n      .eq('user_id', session.user.id)\n      .single();\n    \n    if (!workerData) {\n      return NextResponse.redirect(new URL('/', request.url));\n    }\n  }\n\n  return response;\n}\n\nexport const config = {\n  matcher: [\n    '/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',\n  ],\n};\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AAAA;;;AAEO,eAAe,WAAW,OAAoB;IACnD,IAAI,WAAW,gMAAY,CAAC,IAAI,CAAC;QAC/B,SAAS;YACP,SAAS,QAAQ,OAAO;QAC1B;IACF;IAEA,MAAM,WAAW,IAAA,uMAAkB,sUAGjC;QACE,SAAS;YACP,KAAI,IAAY;gBACd,OAAO,QAAQ,OAAO,CAAC,GAAG,CAAC,OAAO;YACpC;YACA,KAAI,IAAY,EAAE,KAAa,EAAE,OAAsB;gBACrD,QAAQ,OAAO,CAAC,GAAG,CAAC;oBAClB;oBACA;oBACA,GAAG,OAAO;gBACZ;gBACA,WAAW,gMAAY,CAAC,IAAI,CAAC;oBAC3B,SAAS;wBACP,SAAS,QAAQ,OAAO;oBAC1B;gBACF;gBACA,SAAS,OAAO,CAAC,GAAG,CAAC;oBACnB;oBACA;oBACA,GAAG,OAAO;gBACZ;YACF;YACA,QAAO,IAAY,EAAE,OAAsB;gBACzC,QAAQ,OAAO,CAAC,GAAG,CAAC;oBAClB;oBACA,OAAO;oBACP,GAAG,OAAO;gBACZ;gBACA,WAAW,gMAAY,CAAC,IAAI,CAAC;oBAC3B,SAAS;wBACP,SAAS,QAAQ,OAAO;oBAC1B;gBACF;gBACA,SAAS,OAAO,CAAC,GAAG,CAAC;oBACnB;oBACA,OAAO;oBACP,GAAG,OAAO;gBACZ;YACF;QACF;IACF;IAGF,6BAA6B;IAC7B,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,UAAU;IAE5D,iBAAiB;IACjB,MAAM,WAAW,QAAQ,OAAO,CAAC,QAAQ;IAEzC,4BAA4B;IAC5B,MAAM,kBAAkB;QAAC;QAAY;QAAc;KAAW;IAC9D,MAAM,mBAAmB,gBAAgB,IAAI,CAAC,CAAA,QAAS,SAAS,UAAU,CAAC;IAE3E,IAAI,oBAAoB,CAAC,SAAS;QAChC,MAAM,cAAc,IAAI,IAAI,eAAe,QAAQ,GAAG;QACtD,YAAY,YAAY,CAAC,GAAG,CAAC,YAAY;QACzC,OAAO,gMAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,0BAA0B;IAC1B,IAAI,SAAS,UAAU,CAAC,WAAW;QACjC,IAAI,CAAC,SAAS;YACZ,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,gBAAgB,QAAQ,GAAG;QAClE;QAEA,oBAAoB;QACpB,MAAM,EAAE,MAAM,QAAQ,EAAE,GAAG,MAAM,SAC9B,IAAI,CAAC,SACL,MAAM,CAAC,QACP,EAAE,CAAC,MAAM,QAAQ,IAAI,CAAC,EAAE,EACxB,MAAM;QAET,IAAI,UAAU,SAAS,SAAS;YAC9B,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;QACvD;IACF;IAEA,2BAA2B;IAC3B,IAAI,SAAS,UAAU,CAAC,cAAc,CAAC,SAAS,QAAQ,CAAC,WAAW;QAClE,IAAI,CAAC,SAAS;YACZ,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,iBAAiB,QAAQ,GAAG;QACnE;QAEA,qBAAqB;QACrB,MAAM,EAAE,MAAM,UAAU,EAAE,GAAG,MAAM,SAChC,IAAI,CAAC,WACL,MAAM,CAAC,MACP,EAAE,CAAC,WAAW,QAAQ,IAAI,CAAC,EAAE,EAC7B,MAAM;QAET,IAAI,CAAC,YAAY;YACf,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;QACvD;IACF;IAEA,OAAO;AACT;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;KACD;AACH"}}]
}